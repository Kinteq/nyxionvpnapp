# üîí –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **–ú–∞–∫—Å–∏–º—É–º 3 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞** –Ω–∞ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É `deviceId` (Telegram ID + UserAgent)
- –ó–∞–ø–∏—Å—å IP-–∞–¥—Ä–µ—Å–∞ –∏ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

### Backend API (VPS)
```python
# api_endpoints.py
user_devices = {}  # {user_id: [{device_id, ip, first_seen, last_seen}]}
MAX_DEVICES_PER_USER = 3

def register_device(user_id, device_id, ip_address):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
```

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `GET /api/devices?userId=123` - —Å–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- `DELETE /api/devices` - —É–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `GET /api/subscription?userId=123&deviceId=xxx` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π

### Frontend (Vercel)

**app/page.tsx (–ì–ª–∞–≤–Ω–∞—è):**
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è `deviceId` –∏–∑ Telegram ID + UserAgent
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤: `üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤: 2/3`
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞
- –ö–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å" ‚Üí "–ü—Ä–æ–¥–ª–∏—Ç—å" –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–µ
- –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏: —Å—Ä–æ–∫, –¥–Ω–∏, —Ç—Ä–∞—Ñ–∏–∫

**app/profile/page.tsx (–ü—Ä–æ—Ñ–∏–ª—å):**
- –°–µ–∫—Ü–∏—è "üì± –ú–æ–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞"
- –°–ø–∏—Å–æ–∫ —Å device_id, IP, –≤—Ä–µ–º–µ–Ω–µ–º –≤—Ö–æ–¥–∞
- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

## üß™ –¢–µ—Å—Ç—ã

### Backend API
```bash
# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
curl -X POST http://62.60.217.189:3333/api/activate-promo \
  -H "Content-Type: application/json" \
  -d '{"userId": 99999, "promoCode": "KMPLZ7713"}'

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ 1
curl 'http://62.60.217.189:3333/api/subscription?userId=99999&deviceId=test_device_1'
# –†–µ–∑—É–ª—å—Ç–∞—Ç: {"devicesCount": 1, "maxDevices": 3}

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ 2
curl 'http://62.60.217.189:3333/api/subscription?userId=99999&deviceId=test_device_2'
# –†–µ–∑—É–ª—å—Ç–∞—Ç: {"devicesCount": 2, "maxDevices": 3}

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ 3
curl 'http://62.60.217.189:3333/api/subscription?userId=99999&deviceId=test_device_3'
# –†–µ–∑—É–ª—å—Ç–∞—Ç: {"devicesCount": 3, "maxDevices": 3}

# –ü–æ–ø—ã—Ç–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ 4-–≥–æ (–û–®–ò–ë–ö–ê)
curl 'http://62.60.217.189:3333/api/subscription?userId=99999&deviceId=test_device_4'
# –†–µ–∑—É–ª—å—Ç–∞—Ç:
{
  "isActive": false,
  "error": "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (3). –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ –ø—Ä–æ—Ñ–∏–ª–µ.",
  "deviceLimitReached": true
}

# –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
curl 'http://62.60.217.189:3333/api/devices?userId=99999'
# –†–µ–∑—É–ª—å—Ç–∞—Ç:
{
  "devices": [
    {
      "device_id": "test_device_1",
      "ip": "62.60.217.189",
      "first_seen": "2026-01-16T20:25:40.480121+00:00",
      "last_seen": "2026-01-16T20:25:40.480121+00:00"
    },
    ...
  ],
  "count": 3,
  "maxDevices": 3
}

# –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
curl -X DELETE http://62.60.217.189:3333/api/devices \
  -H "Content-Type: application/json" \
  -d '{"userId": 99999, "deviceId": "test_device_2"}'
# –†–µ–∑—É–ª—å—Ç–∞—Ç: {"success": true, "message": "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–æ"}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ (–æ—Å—Ç–∞–ª–æ—Å—å 2)
curl 'http://62.60.217.189:3333/api/devices?userId=99999' | jq '.count'
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 2
```

## üé® UI/UX —É–ª—É—á—à–µ–Ω–∏—è

### –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
**–û–±—ã—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞:**
- ‚úÖ –ó–µ–ª–µ–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
- –ò—Å—Ç–µ–∫–∞–µ—Ç: –¥–∞—Ç–∞
- –û—Å—Ç–∞–ª–æ—Å—å: –¥–Ω–µ–π
- **–¢—Ä–∞—Ñ–∏–∫: GB** ‚Üê –î–û–ë–ê–í–õ–ï–ù–û
- üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤: X/3 ‚Üê –î–û–ë–ê–í–õ–ï–ù–û

**–ë–µ–∑–ª–∏–º–∏—Ç–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞:**
- üëë –ó–æ–ª–æ—Ç–æ–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
- ‚àû –ë–µ–∑–ª–∏–º–∏—Ç (–≤–º–µ—Å—Ç–æ –¥–∞—Ç—ã)
- üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤: X/3

**–û—à–∏–±–∫–∞ –ª–∏–º–∏—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤:**
- ‚ö†Ô∏è –ö—Ä–∞—Å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞
- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
- –ö–Ω–æ–ø–∫–∞ ‚Üí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (–ø—Ä–æ—Ñ–∏–ª—å)

### –ü—Ä–æ—Ñ–∏–ª—å
**–ù–æ–≤–∞—è —Å–µ–∫—Ü–∏—è "üì± –ú–æ–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞":**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ test_device_1                    [‚úï]‚îÇ
‚îÇ IP: 62.60.217.189                   ‚îÇ
‚îÇ –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥: 16.01.2026 21:25    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîÑ –ö–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å/–ü—Ä–æ–¥–ª–∏—Ç—å"

**–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç:**
```tsx
{subscription?.isActive ? 'üîÑ –ü—Ä–æ–¥–ª–∏—Ç—å' : 'üõí –ö—É–ø–∏—Ç—å'}
```

**–õ–æ–≥–∏–∫–∞:**
- –ù–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ ‚Üí üõí –ö—É–ø–∏—Ç—å
- –ï—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∞ ‚Üí üîÑ –ü—Ä–æ–¥–ª–∏—Ç—å

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Device ID –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
```typescript
const deviceId = `tg_${user.id}_${navigator.userAgent.substring(0, 50).replace(/[^a-zA-Z0-9]/g, '_')}`;
```

**–§–æ—Ä–º–∞—Ç:** `tg_123456_Mozilla_5_0_iPhone_OS_15_0_like_Mac_OS_X`

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- –£–Ω–∏–∫–∞–ª–µ–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- –ü—Ä–∏–≤—è–∑–∞–Ω –∫ Telegram ID (–Ω–µ–ª—å–∑—è –ø–æ–¥–¥–µ–ª–∞—Ç—å)
- –í–∫–ª—é—á–∞–µ—Ç UserAgent (–±—Ä–∞—É–∑–µ—Ä/–û–°)
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–º–µ–Ω–∞ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- Max 3 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ù–µ–ª—å–∑—è –ø–µ—Ä–µ–¥–∞—Ç—å –∫–ª—é—á –¥—Ä—É–≥—É (—Ä–∞–∑–Ω—ã–π Telegram ID)
- –ú–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ—Ñ–∏–ª—å

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Mini App (Telegram)
    ‚Üì deviceId –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
GET /api/subscription?userId=X&deviceId=Y
    ‚Üì Vercel proxy
VPS /api/subscription
    ‚Üì register_device()
–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ (3 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
    ‚Üì [–û–ö] ‚Üí –∑–∞–ø–∏—Å—å/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    ‚Üì [FAIL] ‚Üí deviceLimitReached
–í–æ–∑–≤—Ä–∞—Ç –¥–∞–Ω–Ω—ã—Ö + devicesCount
```

## üöÄ –î–µ–ø–ª–æ–π

**Backend (VPS):**
```bash
scp api_endpoints.py root@62.60.217.189:/root/nyxion-bot/
ssh root@62.60.217.189 'systemctl restart nyxion-bot'
```

**Frontend (Vercel):**
```bash
git add -A
git commit -m "Add device management system"
git push origin main
# –ê–≤—Ç–æ–¥–µ–ø–ª–æ–π –Ω–∞ Vercel
```

**–ö–æ–º–º–∏—Ç:** `bb99bd2`

## üìù –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

### VPS
- `api_endpoints.py` - —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### Vercel
- `app/api/devices/route.ts` - –ø—Ä–æ–∫—Å–∏ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- `app/page.tsx` - –≥–ª–∞–≤–Ω–∞—è —Å deviceId, –ª–∏–º–∏—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤, –∫–Ω–æ–ø–∫–∞ –ø—Ä–æ–¥–ª–∏—Ç—å
- `app/profile/page.tsx` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

## üí° –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–ò–∑–º–µ–Ω–∏—Ç—å –ª–∏–º–∏—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤:**
```python
# api_endpoints.py
MAX_DEVICES_PER_USER = 5  # –∏–∑–º–µ–Ω–∏—Ç—å —Å 3 –Ω–∞ 5
```

**–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```bash
curl 'http://62.60.217.189:3333/api/devices?userId=TELEGRAM_ID'
```

**–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:**
```bash
curl -X DELETE http://62.60.217.189:3333/api/devices \
  -H "Content-Type: application/json" \
  -d '{"userId": TELEGRAM_ID, "deviceId": "DEVICE_ID"}'
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 16.01.2026 23:26 CET
**–í–µ—Ä—Å–∏—è:** 2.0 (Device Management System)
